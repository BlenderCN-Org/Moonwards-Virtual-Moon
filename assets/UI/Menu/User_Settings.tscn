[gd_scene load_steps=6 format=2]

[ext_resource path="res://themes/MainMenu.tres" type="Theme" id=1]
[ext_resource path="res://addons/HuePicker/HuePicker.tscn" type="PackedScene" id=2]
[ext_resource path="res://assets/Greenman/green_man2.tscn" type="PackedScene" id=3]

[sub_resource type="GDScript" id=1]
script/source = "extends Control
var username = ''
var color_global = Color8(0,0,0,255)
signal ui_event

func loader(): 
	var savefile = File.new()
	if not savefile.file_exists(\"user://settings.save\"):
		print(\"Nothing was saved before\")
	else:
		savefile.open(\"user://settings.save\", File.READ)
		var content = parse_json(savefile.get_as_text())
		savefile.close()
		username = content[\"username\"]
		color_global = Color8(content[\"colorR\"],content[\"colorG\"],content[\"colorB\"],255)
		$MainPanel/HBoxContainer/VBoxContainer/UsernameContainer/UsernameTextEdit.text = username
		$MainPanel/HBoxContainer/VBoxContainer/HuePicker.color = color_global
		

func save():
	var savefile = File.new()
	savefile.open(\"user://settings.save\", File.WRITE)
	var save_dict = {
		
		\"username\" : username, 
		\"colorR\" : color_global.r*255, # Vector3 is not supported by JSON
		\"colorG\" : color_global.g*255,
		\"colorB\" : color_global.b*255,
		}
	savefile.store_line(to_json(save_dict))
	savefile.close()

func _ready():
	loader()

func _on_Button_save_pressed():
	save()
	emit_signal(\"ui_event\", \"Back\")

func _on_HuePicker_Hue_Selected(color):
	$MainPanel/HBoxContainer/ViewportContainer/Viewport/green_man2.change_color(color)
	color_global = color

func _unhandled_input(event):
	username = $MainPanel/HBoxContainer/VBoxContainer/UsernameContainer/UsernameTextEdit.text

func _on_CfgPlayer_pressed():
	$WindowDialog.popup_centered()
"

[sub_resource type="GDScript" id=2]
script/source = "extends ViewportContainer

func _on_ViewportContainer_item_rect_changed():
	$Viewport.size = rect_size
"

[node name="Control" type="Control"]
anchor_right = 1.0
anchor_bottom = 1.0
size_flags_horizontal = 3
size_flags_vertical = 3
script = SubResource( 1 )

[node name="MainPanel" type="Panel" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
margin_left = 20.0
margin_top = 20.0
margin_right = -20.0
margin_bottom = -20.0
theme = ExtResource( 1 )

[node name="HBoxContainer" type="HBoxContainer" parent="MainPanel"]
anchor_right = 1.0
anchor_bottom = 1.0

[node name="VBoxContainer" type="VBoxContainer" parent="MainPanel/HBoxContainer"]
margin_right = 500.0
margin_bottom = 660.0
size_flags_horizontal = 3
size_flags_vertical = 3
custom_constants/separation = 15
alignment = 1

[node name="Label3" type="Label" parent="MainPanel/HBoxContainer/VBoxContainer"]
margin_top = 128.0
margin_right = 500.0
margin_bottom = 146.0
text = "Use an account to sync your settings"
align = 1

[node name="UsernameContainer" type="HBoxContainer" parent="MainPanel/HBoxContainer/VBoxContainer"]
margin_top = 161.0
margin_right = 500.0
margin_bottom = 189.0
size_flags_horizontal = 5
alignment = 1

[node name="UsernameLabel" type="Label" parent="MainPanel/HBoxContainer/VBoxContainer/UsernameContainer"]
margin_left = 113.0
margin_top = 5.0
margin_right = 182.0
margin_bottom = 23.0
text = "Username:"
align = 1
__meta__ = {
"_edit_group_": true
}

[node name="UsernameTextEdit" type="LineEdit" parent="MainPanel/HBoxContainer/VBoxContainer/UsernameContainer"]
margin_left = 186.0
margin_right = 386.0
margin_bottom = 28.0
rect_min_size = Vector2( 200, 0 )
text = "Player1"
align = 1
context_menu_enabled = false

[node name="AvatarColorLabel" type="Label" parent="MainPanel/HBoxContainer/VBoxContainer"]
margin_top = 204.0
margin_right = 500.0
margin_bottom = 222.0
text = "Avatar Color:"
align = 1

[node name="HuePicker" parent="MainPanel/HBoxContainer/VBoxContainer" instance=ExtResource( 2 )]
margin_top = 237.0
margin_right = 500.0
margin_bottom = 487.0
rect_min_size = Vector2( 500, 250 )

[node name="Button" type="Button" parent="MainPanel/HBoxContainer/VBoxContainer"]
margin_left = 225.0
margin_top = 502.0
margin_right = 275.0
margin_bottom = 532.0
rect_min_size = Vector2( 50, 30 )
size_flags_horizontal = 4
text = "Save"

[node name="ViewportContainer" type="ViewportContainer" parent="MainPanel/HBoxContainer"]
margin_left = 504.0
margin_right = 984.0
margin_bottom = 660.0
size_flags_horizontal = 3
size_flags_vertical = 3
script = SubResource( 2 )

[node name="Viewport" type="Viewport" parent="MainPanel/HBoxContainer/ViewportContainer"]
transparent_bg = true
handle_input_locally = false
render_target_update_mode = 3

[node name="green_man2" parent="MainPanel/HBoxContainer/ViewportContainer/Viewport" instance=ExtResource( 3 )]

[connection signal="text_changed" from="MainPanel/HBoxContainer/VBoxContainer/UsernameContainer/UsernameTextEdit" to="." method="_on_TextEdit_text_changed"]
[connection signal="Hue_Selected" from="MainPanel/HBoxContainer/VBoxContainer/HuePicker" to="." method="_on_HuePicker_Hue_Selected"]
[connection signal="pressed" from="MainPanel/HBoxContainer/VBoxContainer/Button" to="." method="_on_Button_save_pressed"]
[connection signal="item_rect_changed" from="MainPanel/HBoxContainer/ViewportContainer" to="MainPanel/HBoxContainer/ViewportContainer" method="_on_ViewportContainer_item_rect_changed"]
